<div fxLayout="row" fxLayoutGap="10px">
    <div fxFlex.gt-lg="100" fxFlex.gt-md="100" fxFlex.gt-xs="100" fxFlex="100" style="float:left;">
        <h2 mat-dialog-title class="primary_title" style="float:left;"> Inspections & Repairs

            <span style="font-size: medium; color: darkmagenta; font-style: normal; font-weight: normal;">
                - Property Inspection
            </span>
        </h2>

    </div>
    <div fxFlex.gt-lg="10" fxFlex.gt-md="10" fxFlex.gt-xs="100" fxFlex="100" align="end">
        <mat-icon [mat-dialog-close]="true" style="cursor:pointer">close</mat-icon>
    </div>
</div>

<mat-dialog-content class="mat-typography" *ngIf="permanentHome.groupIr.length > 0">


    <div class="" style="padding: 10px; margin-top: 20px; margin-bottom: 20px;">

        <div>
            <div class="" style="padding: 10px; margin-top: 20px; margin-bottom: 20px;">
                <mat-grid-list cols="4" rowHeight="70px">
                    <mat-grid-tile [colspan]="1" [rowspan]="1">
                        <div class="input_central textarea">
                            <mat-form-field appearance="fill">
                                <mat-label>Status Report</mat-label>
                                <mat-select [(ngModel)]="permanentHome.groupIr[0].idStatus"
                                    (selectionChange)="save_ir_status();" [disabled]="!data.edicion">
                                    <mat-option *ngFor="let item of ca_status_report" [value]='item.id'>{{item.status}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-grid-tile>
                </mat-grid-list>

                <mat-grid-list cols="4" rowHeight="70px">

                    <mat-grid-tile [colspan]="4" [rowspan]="1">
                        <div style="width: 100%;">
                            <div>
                                <p class="page__section-name">Inspections</p>
                            </div>
                        </div>
                    </mat-grid-tile>

                </mat-grid-list>

                <div class="mat-elevation-z5" style="padding: 20px; margin-bottom: 20px; position: relative;"
                    *ngFor="let item of data_inspection; let k = index">
                    <mat-grid-list cols="4" rowHeight="70px">
                        <mat-grid-tile [colspan]="1" [rowspan]="1">
                            <div class="input_central textarea">
                                <mat-form-field appearance="fill">
                                    <mat-label>Inspection Date</mat-label>
                                    <input matInput [matDatepicker]="pickertres" placeholder="Initial Inspection Date"
                                        [(ngModel)]='item.initialInspectionDate'>
                                    <mat-datepicker-toggle matSuffix [for]="pickertres"></mat-datepicker-toggle>
                                    <mat-datepicker #pickertres></mat-datepicker>
                                </mat-form-field>
                            </div>
                        </mat-grid-tile>
                        <mat-grid-tile [colspan]="1" [rowspan]="1">
                            <div class="input_central textarea">
                                <mat-form-field appearance="fill">
                                    <mat-label>Inspection Type</mat-label>
                                    <mat-select [(ngModel)]="item.inspectType">
                                        <mat-option *ngFor="let s of ca_inspec_type" [value]='s.id'>{{s.type}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </mat-grid-tile>
                        <mat-grid-tile [colspan]="1" [rowspan]="1">
                            <div class="input_central textarea">
                                <mat-form-field appearance="fill">
                                    <mat-label>Property Section</mat-label>
                                    <mat-select [(ngModel)]="item.propertySection">
                                        <mat-option *ngFor="let s of ca_propertySection"
                                            [value]='s.id'>{{s.propertySection}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </mat-grid-tile>
                        <mat-grid-tile [colspan]="1" [rowspan]="1">
                            <div class="input_central textarea">
                                <span class="browser" style="cursor: pointer;" (click)="item.show = true"
                                    *ngIf="!item.show"><img src="../../../../assets/icons/arrow_down.png"
                                        style="width: 22px;"></span>
                                <span class="browser" style="cursor: pointer;" (click)="item.show = false"
                                    *ngIf="item.show"><img src="../../../../assets/icons/arrow_right.png"
                                        style="width: 22px;"></span>
                            </div>
                            <img src="assets/trashir.png" class="delete" style="margin-top: 15px; 
                            background: transparent!important; width: 25px;" (click)="delete_inspection(item)">
                        </mat-grid-tile>


                    </mat-grid-list>

                    <div *ngIf="item.show">
                        <mat-grid-tile [colspan]="4" [rowspan]="1">
                            <div class="textarea">
                                <p class="subtitle" style="font-size: 12px; margin: 0px;">Inspection Details</p>
                                <mat-form-field appearance="outline" class="textarea" style="width: 100% !important;">
                                    <textarea matInput #messager maxlength="500"
                                        [(ngModel)]="item.inspecDetails"></textarea>
                                    <mat-hint align="end">{{messager.value.length}} / 500</mat-hint>
                                </mat-form-field>
                            </div>
                        </mat-grid-tile>
                        <mat-grid-list cols="4" rowHeight="70px">
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <div class="page__section-buttong"
                                    style="display: flex; justify-content: flex-start; flex: 0px !important;">
                                    <button class="button-icon"
                                        style="background-color: #9d3292; color: white; width: 200px;"
                                        (click)="update_ispection(item)" *ngIf="data.edicion">
                                        Save Inspection Header
                                    </button>
                                </div>
                            </mat-grid-tile>
                            <mat-grid-tile [colspan]="1" [rowspan]="1">
                                <div>
                                    <p class="page__section-name" style="font-size: 14px;">Actions</p>
                                </div>
                            </mat-grid-tile>
                            <mat-grid-tile [colspan]="3" [rowspan]="1"></mat-grid-tile>


                        </mat-grid-list>

                        <div class="page__section">
                            <!---------------------------TABLA HOUSING------------------------------>
                            <table matTableExporter mat-table [dataSource]="item.repairs"
                                class="mat-elevation-z8 textarea">
                                <ng-container matColumnDef="Address">
                                    <th mat-header-cell *matHeaderCellDef> Action Type </th>
                                    <td mat-cell *matCellDef="let element" style="cursor:pointer;">
                                        <a style="color: blue; text-decoration: underline; cursor: pointer;"
                                            (click)="edit_action(element, itme)">
                                            {{getRepair(element.repairType)}}
                                        </a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="Neighborhood">
                                    <th mat-header-cell *matHeaderCellDef> Start Date </th>
                                    <td mat-cell *matCellDef="let element">
                                        {{element.repairStartDate | date: 'MM/dd/yyyy'}} </td>
                                </ng-container>
                                <ng-container matColumnDef="Price">
                                    <th mat-header-cell *matHeaderCellDef> Total Days </th>
                                    <td mat-cell *matCellDef="let element">{{element.totalDays}} </td>
                                </ng-container>
                                <ng-container matColumnDef="Property Type">
                                    <th mat-header-cell *matHeaderCellDef> Total Cost </th>
                                    <td mat-cell *matCellDef="let element"> {{element.totalCostRepair | currency }}
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="photos">
                                    <th mat-header-cell *matHeaderCellDef> Photos </th>
                                    <td mat-cell *matCellDef="let element">
                                        {{element.documentRepairs.length}}
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="displayedColumnsHousing"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumnsHousing;"></tr>
                            </table>
                        </div>
                        <mat-grid-list cols="4" rowHeight="70px">
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <div class="addPropperty">
                                    <div class="page__section-button page__section-button--big">
                                        <button class="button-icon button-icon--more" (click)="addAction(item)"
                                            *ngIf="data.edicion">
                                            Action
                                        </button>
                                    </div>
                                </div>
                            </mat-grid-tile>


                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <p class="page__section-name" style="font-size: 14px;"> Attendees</p>
                            </mat-grid-tile>

                        </mat-grid-list>
                        <div class="page__section">
                            <table matTableExporter mat-table [dataSource]="item.attendeeInspecs"
                                class="mat-elevation-z8 textarea">
                                <ng-container matColumnDef="tittle">
                                    <th mat-header-cell *matHeaderCellDef> Title </th>
                                    <td mat-cell *matCellDef="let attend" style="cursor:pointer;">
                                        <a style="color: blue; text-decoration: underline; cursor: pointer;"
                                            (click)="editAttendInspec(attend, at)">
                                            {{get_attendiees_vales(attend.att)}}
                                        </a>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="name">
                                    <th mat-header-cell *matHeaderCellDef> name </th>
                                    <td mat-cell *matCellDef="let attend">
                                        {{attend.name}} </td>
                                </ng-container>
                                <ng-container matColumnDef="email">
                                    <th mat-header-cell *matHeaderCellDef> Email </th>
                                    <td mat-cell *matCellDef="let attend">
                                        {{attend.email}}
                                    </td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="displayedColumnsAttend"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumnsAttend;"></tr>
                            </table>
                        </div>
                        <!-------------------------------------STAR PHOTOS ---------------------------------------------------->
                        <mat-grid-list cols="4" rowHeight="70px">
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <div class="addPropperty">
                                    <div class="page__section-button page__section-button--big">
                                        <button class="button-icon button-icon--more" (click)="addAttendeesInspec(item)"
                                            *ngIf="data.edicion">
                                            Attendee
                                        </button>
                                    </div>
                                </div>
                            </mat-grid-tile>
                            <br>
                            <!-- <mat-grid-tile [colspan]="1" [rowspan]="1">
                                <div>
                                    <p class="page__section-name" style="font-size: 14px;">Photos</p>
                                </div>
                            </mat-grid-tile> -->


                        </mat-grid-list>


                        <!-- <ngx-file-drop style="display:none" class="file-drop" dropZoneLabel="Drop files here"
                            (onFileDrop)="droppedFotosInspec($event, k, item)" (onFileOver)="fileOver($event, i)"
                            (onFileLeave)="fileLeave($event, i)" [multiple]="false">
                            <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                                Drag and Drop or
                                <p class="browser" id="doc_i{{k}}" (click)="openFileSelector()">Browse File</p>
                            </ng-template>
                        </ngx-file-drop>
                        <div class="photos">
                            <div class="photo" *ngFor="let it of item.photosInspecs; let p = index">
                                <img src="assets/icons/quit.svg" class="delete" (click)="deletePhoto_ins(it.id, p, item.photosInspecs, k)">
                                <img src="{{it.base64}}" class="img" alt="" *ngIf="it.id == 0">
                                <img src="{{_services.url_images}}{{it.photo}}" class="img" alt="" *ngIf="it.id != 0">
                            </div>
                        </div>
                        <mat-grid-list cols="4" rowHeight="70px">
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <div class="addPropperty">
                                    <div class="page__section-button page__section-button--big" *ngIf = "data.edicion">
                                        <button class="button-icon button-icon--more" (click)="addFotosMoveInspec(k)">
                                            Photos
                                        </button>
                                    </div>
                                </div>
                            </mat-grid-tile>
                        </mat-grid-list>  -->
                        <!-------------------------------------END PHOTOS ---------------------------------------------------->
                    </div>
                </div>

                <mat-grid-list cols="4" rowHeight="70px">

                    <mat-grid-tile [colspan]="4" [rowspan]="1">
                        <div class="addPropperty">
                            <div class="page__section-button page__section-button--big" *ngIf="data.edicion">
                                <button class="button-icon button-icon--more" (click)='addInspectionDate("1")'>
                                    Add Inspection
                                </button>
                            </div>
                        </div>
                    </mat-grid-tile>

                    <!-- <mat-grid-tile [colspan]="4" [rowspan]="1">
                        <div style="width: 100%;">
                            <div>
                                <p class="page__section-name">Repairs</p>
                            </div>
                        </div>
                    </mat-grid-tile> -->

                </mat-grid-list>


            </div>
            <!---------------------------------- PINTAR CONTRACTS PASADOS ----------------------------->
        </div>
    </div>

</mat-dialog-content>

<mat-dialog-actions align="end">

    <!-- <div class="page__section-buttong" style="flex: 0 1 100px;">
        <button *ngIf="data.edicion">Save </button>
    </div> -->
</mat-dialog-actions>